<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tiling Cost Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: auto;
      background: #f9f9f9;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    label, input, select {
      display: block;
      width: 100%;
      margin: 10px 0;
      font-size: 16px;
    }
    input, select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    button {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-top: 10px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
    }
    .adslot {
      background: #ecf0f1;
      border: 2px dashed #bdc3c7;
      text-align: center;
      padding: 20px;
      margin: 20px 0;
    }
    #ad-container {
      background: #e1f7d5;
      padding: 20px;
      text-align: center;
      font-weight: bold;
    }
    #report-container {
      display: none;
    }
    pre {
      white-space: pre-wrap;
      background: #fff;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 5px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Tiling Cost Calculator</h1>

  <div class="adslot">üîó Ad Slot (AdSense / Adsterra)</div>

  <div id="ad-container">
    Please watch this short ad to unlock your tiling cost report. <br><br>
    <button onclick="adWatchedComplete()">I watched the ad</button>
  </div>

  <div id="report-container">
    <label>Total Area (sqft):</label>
    <input type="number" id="area">

    <label>Tile Type:</label>
    <select id="tileType">
      <option value="Ceramic">Ceramic</option>
      <option value="Porcelain">Porcelain</option>
      <option value="Mosaic">Mosaic</option>
      <option value="Terracotta">Terracotta</option>
    </select>

    <label>Tile Size:</label>
    <select id="tilePreset" onchange="updateTileSizeFromDropdown()">
      <option value="3.87">2x2 (600√ó600 mm)</option>
      <option value="7.75">2x4 (600√ó1200 mm)</option>
      <option value="0.97">1x1 (300√ó300 mm)</option>
      <option value="1.94">1x2 (300√ó600 mm)</option>
      <option value="15.5">4x4 (1200√ó1200 mm)</option>
      <option value="custom">Custom Size</option>
    </select>

    <div id="customTileSizeInput" style="display:none;">
      Tile Size (sqft): <input type="number" id="tileSizeSqft" step="0.01">
    </div>

    <label>Tile Price (LKR per tile):</label>
    <input type="number" id="tilePrice">

    <label>Skirting Length (ft):</label>
    <input type="number" id="skirting" placeholder="Leave blank for auto 20%">

    <label>Cement Price (50kg bag):</label>
    <input type="number" id="cementPrice">

    <label>Sand Price (1 cube):</label>
    <input type="number" id="sandPrice">

    <label>Tile Adhesive Price (25kg bag):</label>
    <input type="number" id="adhesivePrice">

    <label>Leveling Clip Price (100 pcs):</label>
    <input type="number" id="clipPrice">

    <label>Grout Price (1kg):</label>
    <input type="number" id="groutPrice">

    <label>Labor Rate (LKR per sqft):</label>
    <input type="number" id="laborRate" placeholder="Optional">

    <button onclick="calculate()">Calculate</button>
    <button onclick="downloadPDF()">Download PDF</button>

    <pre id="output"></pre>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
const { jsPDF } = window.jspdf;
let adWatched = false;

function adWatchedComplete() {
  adWatched = true;
  document.getElementById("ad-container").style.display = "none";
  document.getElementById("report-container").style.display = "block";
}

function updateTileSizeFromDropdown() {
  const preset = document.getElementById("tilePreset").value;
  const customInput = document.getElementById("customTileSizeInput");
  if (preset === "custom") {
    customInput.style.display = "block";
  } else {
    customInput.style.display = "none";
    document.getElementById("tileSizeSqft").value = preset;
  }
}

function calculate() {
  if (!adWatched) {
    alert("Please watch the ad first.");
    return;
  }

  const sqft = parseFloat(document.getElementById("area").value);
  const tileSize = parseFloat(document.getElementById("tileSizeSqft").value);
  const skirtingInput = document.getElementById("skirting").value;
  const skirting = skirtingInput ? parseFloat(skirtingInput) : Math.ceil(sqft * 0.2);
  const tilePrice = parseFloat(document.getElementById("tilePrice").value);
  const tileType = document.getElementById("tileType").value;

  if (!sqft || !tileSize) {
    alert("Please enter valid area and tile size.");
    return;
  }

  const floorTiles = Math.ceil(sqft / tileSize);
  const skirtingTiles = Math.ceil(skirting / 12);
  const totalTiles = Math.ceil((floorTiles + skirtingTiles) * 1.05);
  const tileCost = tilePrice > 0 ? totalTiles * tilePrice : null;

  const cementQtyMin = 10 * (sqft / 1000);
  const cementQtyMax = 14 * (sqft / 1000);
  const sandQtyMin = 1.25 * (sqft / 1000);
  const sandQtyMax = 1.75 * (sqft / 1000);
  const adhesiveQtyMin = 25 * (sqft / 1000);
  const adhesiveQtyMax = 40 * (sqft / 1000);
  const clipQty = Math.ceil(sqft / 100);
  const groutQty = Math.ceil(sqft / 175);

  // Prices
  const cementPrice = parseFloat(document.getElementById("cementPrice").value);
  const sandPrice = parseFloat(document.getElementById("sandPrice").value);
  const adhesivePrice = parseFloat(document.getElementById("adhesivePrice").value);
  const clipPrice = parseFloat(document.getElementById("clipPrice").value);
  const groutPrice = parseFloat(document.getElementById("groutPrice").value);
  const laborRate = parseFloat(document.getElementById("laborRate").value);

  // Check if all prices are entered
  const allPricesEntered = [tilePrice, cementPrice, sandPrice, adhesivePrice, clipPrice, groutPrice].every(p => !isNaN(p) && p > 0);

  // Cost calculations
  let report = `üìã Tiling Report:

üìê Area: ${sqft.toFixed(2)} sqft
üß± Tile Type: ${tileType}
üìè Tile Size: ${tileSize.toFixed(2)} sqft
üìè Skirting: ${skirting.toFixed(0)} ft

üßÆ Tile Quantity:
- Floor Tiles: ${floorTiles}
- Skirting Tiles: ${skirtingTiles}
- Wastage (5%): ${Math.ceil((floorTiles + skirtingTiles) * 0.05)}
‚û° Total Tiles Required: ${totalTiles}
`;

  if (tileCost !== null) {
    report += `üí∞ Tile Cost: LKR ${tileCost.toFixed(0)}\n`;
  } else {
    report += `üí∞ Tile Cost: (Enter tile price to calculate)\n`;
  }

  report += `
üì¶ Material Quantities:
- Cement: ${cementQtyMin.toFixed(2)} ‚Äì ${cementQtyMax.toFixed(2)} bags
- Sand: ${sandQtyMin.toFixed(2)} ‚Äì ${sandQtyMax.toFixed(2)} cubes
- Tile Adhesive: ${adhesiveQtyMin.toFixed(2)} ‚Äì ${adhesiveQtyMax.toFixed(2)} bags
- Leveling Clips: ${clipQty} packets
- Grout: ${groutQty} packets
`;

  if (allPricesEntered) {
    const cementCostMin = cementQtyMin * cementPrice;
    const cementCostMax = cementQtyMax * cementPrice;
    const sandCostMin = sandQtyMin * sandPrice;
    const sandCostMax = sandQtyMax * sandPrice;
    const adhesiveCostMin = adhesiveQtyMin * adhesivePrice;
    const adhesiveCostMax = adhesiveQtyMax * adhesivePrice;
    const clipCost = clipQty * clipPrice;
    const groutCost = groutQty * groutPrice;
    const laborCost = laborRate ? sqft * laborRate : 0;

    const totalMin = tileCost + cementCostMin + sandCostMin + adhesiveCostMin + clipCost + groutCost + laborCost;
    const totalMax = tileCost + cementCostMax + sandCostMax + adhesiveCostMax + clipCost + groutCost + laborCost;

    report += `
üí∏ Material Costs:
- Cement: LKR ${cementCostMin.toFixed(0)} ‚Äì ${cementCostMax.toFixed(0)}
- Sand: LKR ${sandCostMin.toFixed(0)} ‚Äì ${sandCostMax.toFixed(0)}
- Tile Adhesive: LKR ${adhesiveCostMin.toFixed(0)} ‚Äì ${adhesiveCostMax.toFixed(0)}
- Leveling Clips: LKR ${clipCost.toFixed(0)}
- Grout: LKR ${groutCost.toFixed(0)}

üë∑ Labor Cost: ${laborRate ? "LKR " + laborCost.toFixed(0) : "Not included"}

üßæ Total Cost Estimate:
- Minimum: LKR ${totalMin.toFixed(0)}
- Maximum: LKR ${totalMax.toFixed(0)}
`;
  } else {
    report += `\nüí° Enter all material + tile prices to see full cost estimate.\n`;
  }

  document.getElementById("output").innerText = report;
  window.latestReport = report;
}

function downloadPDF() {
  if (!window.latestReport) {
    alert("Please calculate first.");
    return;
  }
  const doc = new jsPDF();
  const lines = doc.splitTextToSize(window.latestReport, 180);
  doc.text(lines, 10, 10);
  doc.save("tiling_report.pdf");
}
</script>
</body>
</html>
